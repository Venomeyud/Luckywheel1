<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ä¸‰å‘¨å¹´å¿«ä¹ æ±ªé›¯ä¸“å±ç¤¼ç‰©è½¬ç›˜</title>
    <style>
        /* --- 1. å…¨å±€æ ·å¼ --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Helvetica Neue", sans-serif;
            background-color: #E6E6FA; 
            background-image: linear-gradient(135deg, #E6E6FA 0%, #B0C4DE 100%);
            background-size: cover; background-position: center; background-repeat: no-repeat;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 100vh; margin: 0; overflow: hidden; color: #000;
        }
        body::before { content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255, 0.25); backdrop-filter: blur(5px); z-index: -1; }

        /* --- 2. å¡ç‰‡å®¹å™¨ --- */
        .glass-card {
            background: rgba(255, 255, 255, 0.85); border-radius: 30px; padding: 30px 20px;
            width: 90%; max-width: 380px; box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            text-align: center; border: 1px solid rgba(255,255,255,0.6);
            backdrop-filter: blur(10px);
        }
        h1 { margin: 0; font-size: 24px; font-weight: 800; color: #1c1c1e; }
        .subtitle { margin-top: 8px; margin-bottom: 25px; font-size: 14px; color: #666; }

        /* --- 3. è½¬ç›˜éƒ¨åˆ† --- */
        .wheel-wrapper { position: relative; width: 320px; height: 320px; margin: 0 auto 30px auto; filter: drop-shadow(0 10px 15px rgba(0,0,0,0.1)); }
        .pointer {
            position: absolute; top: -25px; left: 50%; transform: translateX(-50%); width: 40px; height: 50px; z-index: 50;
            background-image: url("data:image/svg+xml,%3Csvg width='40' height='50' viewBox='0 0 40 50' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M20 50L0 10C0 4.5 4.5 0 10 0H30C35.5 0 40 4.5 40 10L20 50Z' fill='%23FF3B30'/%3E%3C/svg%3E");
            background-size: contain; background-repeat: no-repeat;
        }
        #spinner { width: 100%; height: 100%; position: relative; border-radius: 50%; border: 8px solid #FFB7C5; box-sizing: border-box; background: #fff; overflow: hidden; }
        
        .fan-bg { position: absolute; top: 0; right: 0; width: 50%; height: 50%; transform-origin: 0% 100%; }
        .fan-1, .fan-3, .fan-5 { background: #FFFBE6; } .fan-2, .fan-4, .fan-6 { background: #FFDEE9; } 
        .fan-1 { transform: rotate(0deg) skewY(-30deg); } .fan-2 { transform: rotate(60deg) skewY(-30deg); }
        .fan-3 { transform: rotate(120deg) skewY(-30deg); } .fan-4 { transform: rotate(180deg) skewY(-30deg); }
        .fan-5 { transform: rotate(240deg) skewY(-30deg); } .fan-6 { transform: rotate(300deg) skewY(-30deg); }

        .content-wrap { position: absolute; width: 100%; height: 100%; top: 0; left: 0; }
        .item { position: absolute; top: 50%; left: 50%; width: 0; height: 0; }
        .item-inner { position: absolute; top: -140px; left: -50px; width: 100px; text-align: center; }
        .item img { width: 55px; height: 55px; object-fit: contain; display: block; margin: 0 auto 2px auto; filter: drop-shadow(0 2px 2px rgba(0,0,0,0.1)); }
        .item span { display: block; font-size: 13px; line-height: 1.2; font-weight: 900; color: #333; text-shadow: 1px 1px 0 rgba(255,255,255,0.9); }

        .center-circle {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 70px; height: 70px; background: #fff; border-radius: 50%;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15); z-index: 10; display: flex; align-items: center; justify-content: center; overflow: hidden; border: 3px solid #fff;
        }
        .center-bear-img { width: 100%; height: 100%; object-fit: cover; transform: scale(1.1); }

        /* --- åŠ¨ç”»æ•ˆæœ --- */
        @keyframes btnScale { 0% { transform: scale(1); } 50% { transform: scale(1.08); } 100% { transform: scale(1); } }
        .anim-win { animation: pulseWin 1s infinite; } @keyframes pulseWin { 0% { transform: scale(1); } 50% { transform: scale(1.15) rotate(5deg); } 100% { transform: scale(1); } }
        .anim-lose { animation: shakeLose 0.8s infinite ease-in-out; } @keyframes shakeLose { 0% { transform: rotate(0deg); } 25% { transform: rotate(-10deg); } 50% { transform: rotate(0deg); } 75% { transform: rotate(10deg); } 100% { transform: rotate(0deg); } }
        .anim-zoom { animation: zoomPulse 1.5s infinite ease-in-out; } @keyframes zoomPulse { 0% { transform: scale(1); } 50% { transform: scale(1.15); } 100% { transform: scale(1); } }

        /* --- æŒ‰é’®æ ·å¼ --- */
        #spinBtn {
            width: 80%; padding: 16px; border-radius: 20px; border: none; background: #007AFF; color: white; font-size: 18px; font-weight: bold;
            box-shadow: 0 8px 20px rgba(0, 122, 255, 0.3); cursor: pointer; transition: all 0.2s; animation: btnScale 1.5s infinite ease-in-out;
        }
        #spinBtn:active { transform: scale(0.96); animation: none; }
        #spinBtn:disabled { background: #ccc; box-shadow: none; transform: none; animation: none; }

        /* ä¿¡å°æŒ‰é’®æ ·å¼ (ä¸­å¥–åæ˜¾ç¤º) */
        .envelope-btn {
            background: #FF2D55 !important; /* çˆ±çš„ç²‰çº¢è‰² */
            box-shadow: 0 8px 20px rgba(255, 45, 85, 0.4) !important;
        }

        /* --- å¼¹çª—é€šç”¨ --- */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); z-index: 100;
            align-items: center; justify-content: center;
        }
        .modal-box {
            background: rgba(255,255,255,0.98); width: 80%; max-width: 320px; padding: 30px 20px;
            border-radius: 25px; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
        }
        @keyframes pop { from{transform: scale(0.8); opacity: 0;} to{transform: scale(1); opacity: 1;} }

        /* ã€ä¿®æ”¹ç‚¹ã€‘å¼¹çª—é‡Œçš„å›¾ç‰‡å˜å¤§äº† */
        #m-icon { 
            width: 160px; /* åŸæ¥æ˜¯ 100px */
            height: 160px; /* åŸæ¥æ˜¯ 100px */
            object-fit: contain; 
            margin: 20px auto; /* å¢åŠ äº†ä¸Šä¸‹é—´è·ï¼Œé˜²æ­¢æŒ¡å­— */
            display: block; 
        }
        
        .close-btn {
            background: #FF2D55; color: white; border: none; padding: 12px 30px; border-radius: 20px;
            font-weight: bold; margin-top: 20px; width: 100%; cursor: pointer;
            transition: background 0.3s; animation: btnScale 1.2s infinite ease-in-out;
        }

        /* --- ğŸ’Œ ä¿¡ä»¶å¼¹çª—æ ·å¼ --- */
        #letterModalBox {
            background-image: url('photo.jpg'); 
            background-size: cover; background-position: center; height: 60vh; display: flex; flex-direction: column;
            justify-content: flex-end; padding: 0; overflow: hidden; border: 4px solid #fff;
        }
        .letter-content {
            background: rgba(255, 255, 255, 0.9); padding: 20px; border-radius: 20px 20px 0 0; width: 100%;
            box-sizing: border-box; max-height: 70%; overflow-y: auto;
        }
        .letter-text {
            text-align: left; font-size: 15px; line-height: 1.8; color: #333; margin-bottom: 20px; font-weight: 500; white-space: pre-wrap;
        }

        /* --- ğŸ å¿«é€’ç å›¾ç‰‡æ ·å¼ --- */
        #code-img {
            width: 100%; border-radius: 10px; border: 2px dashed #FF2D55; padding: 5px; box-sizing: border-box; margin-bottom: 10px;
        }

    </style>
</head>
<body>

    <div class="glass-card">
        <h1>ä¸‰å‘¨å¹´å¿«ä¹<br>æ±ªé›¯ä¸“å±ç¤¼ç‰©è½¬ç›˜</h1>
        <div class="subtitle">è€å©†å¤§äººï¼Œè¿™æ¬¡çœ‹æ¸…æ¥šäº†å— â¤ï¸</div>

        <div class="wheel-wrapper">
            <div class="pointer"></div>
            <div id="spinner">
                <div class="fan-bg fan-1"></div><div class="fan-bg fan-2"></div><div class="fan-bg fan-3"></div>
                <div class="fan-bg fan-4"></div><div class="fan-bg fan-5"></div><div class="fan-bg fan-6"></div>

                <div class="content-wrap">
                    <div class="item" style="transform: rotate(30deg);"><div class="item-inner"><img src="makeup.gif" onerror="this.src='https://img.alicdn.com/bao/uploaded/i4/2207692660945/O1CN0188939c20q6vXvQzXQ_!!2207692660945.jpg_300x300.jpg'"><span>åŒ–å¦†å“/ä¿å…»å“</span></div></div>
                    <div class="item" style="transform: rotate(90deg);"><div class="item-inner"><img class="anim-zoom" src="https://cdn-icons-png.flaticon.com/512/5726/5726678.png" style="filter: drop-shadow(0 0 5px gold); width:45px; height:45px;"><span style="color:#d63384">âœ¨ç¥ç§˜å¤§å¥–âœ¨</span></div></div>
                    <div class="item" style="transform: rotate(150deg);"><div class="item-inner"><img src="hongbao.gif" onerror="this.src='https://cdn-icons-png.flaticon.com/512/6451/6451877.png'"><span>çº¢åŒ…388</span></div></div>
                    <div class="item" style="transform: rotate(210deg);"><div class="item-inner"><img src="wind.gif" onerror="this.src='https://cdn-icons-png.flaticon.com/512/416/416835.png'" style="opacity:0.7" class="anim-lose"><span style="color:#666">ä»€ä¹ˆéƒ½æ²¡æœ‰</span></div></div>
                    <div class="item" style="transform: rotate(270deg);"><div class="item-inner"><img src="clothes.gif" onerror="this.src='https://img.alicdn.com/bao/uploaded/i3/2849132476/O1CN01a8899c1s511zXzXzX_!!2849132476.jpg_300x300.jpg'"><span>è¡£è£¤/è£™å­/å†…è¡£</span></div></div>
                    <div class="item" style="transform: rotate(330deg);"><div class="item-inner"><img src="shoes.gif" onerror="this.src='https://cdn-icons-png.flaticon.com/512/2742/2742674.png'"><span>é‹å­</span></div></div>
                </div>

                <div class="center-circle">
                    <img class="center-bear-img" src="bear.gif" alt="å°ç†Š" onerror="this.src='https://cdn-icons-png.flaticon.com/512/3769/3769037.png'">
                </div>
            </div>
        </div>

        <button id="spinBtn" onclick="handleButtonClick()">å¼€å§‹æŠ½å¥–</button>
    </div>

    <div id="resultModal" class="modal-overlay">
        <div class="modal-box">
            <h2 id="m-title">ä¸­å¥–å•¦</h2>
            <img id="m-icon" src="" alt="">
            <p id="m-text" style="color:#666; line-height:1.6;"></p>
            <button id="closeBtn" class="close-btn" onclick="closeResultModal()">å¼€å¿ƒæ”¶ä¸‹</button>
        </div>
    </div>

    <div id="letterModal" class="modal-overlay">
        <div class="modal-box" id="letterModalBox">
            <div class="letter-content">
                <h3 style="margin-top:0; color:#FF2D55;">To: æœ€çˆ±çš„è€å©† ğŸ’Œ</h3>
                <div class="letter-text" id="myLetterText">
äº²çˆ±çš„è€å©†å¤§äººï¼š

ä¸‰å‘¨å¹´å¿«ä¹ï¼ğŸ‰
è¿™å°ä¿¡çš„èƒŒæ™¯æ˜¯æˆ‘ä»¬å”¯ä¸€çš„ä¸€å¼ åˆç…§ã€‚
æˆ‘ä»¬çš„åˆç…§ç‰¹åˆ«å°‘ï¼Œå¸Œæœ›ä¸‹æ¬¡è§é¢èƒ½å¤šæ‹ä¸€äº›åˆç…§ã€‚

ä¸ç»æ„é—´å·²ç»å·²ç»ç›¸è¯†ä¸‰å¹´äº†ï¼Œ
è™½ç„¶ä¸­é—´æœ‰ä¸å°‘æ›²æŠ˜ï¼Œ
ä½†å¾ˆæ„Ÿè°¢ä½ ä¸€ç›´ä»¥æ¥çš„é™ªä¼´å’Œä¿¡ä»»ã€‚

è¿™ä¸‰å¹´æœ‰ä½ çœŸå¥½ï¼Œ
å¸Œæœ›æœªæ¥çš„æ¯ä¸€å¤©éƒ½æ˜¯ä½ ã€‚æˆ‘çˆ±ä½ ã€‚

è¿™æ˜¯æˆ‘ä¸ºä½ å‡†å¤‡çš„ä¸€ä»½å°æƒŠå–œï¼Œ
å¸Œæœ›ä½ ä¼šå–œæ¬¢~ â¤ï¸
                </div>
                <button class="close-btn" onclick="openGiftCode()">ğŸ é¢†å–ç¥ç§˜ç¤¼ç‰©</button>
            </div>
        </div>
    </div>

    <div id="codeModal" class="modal-overlay">
        <div class="modal-box">
            <h2 style="color:#FF2D55;">ç¥ç§˜ç¤¼ç‰©å·²é€è¾¾ï¼</h2>
            <p style="color:#666; font-size:14px;">æˆªå›¾ä¿å­˜ä¸‹æ–¹çš„å–ä»¶ç /å¿«é€’å•</p>
            <img id="code-img" src="code.jpg" class="anim-zoom" alt="ç¤¼ç‰©ç ">
            <p style="margin-bottom:20px;">â¤ï¸ çˆ±ä½ å“Ÿ â¤ï¸</p>
            <button class="close-btn" onclick="location.reload()">å†ç©ä¸€æ¬¡</button>
        </div>
    </div>

    <script>
        const winIcon = "https://cdn-icons-png.flaticon.com/512/4213/4213958.png"; 
        const loseButtonTexts = ["å†è¯•ä¸€æ¬¡!", "æˆ‘ä¸ä¿¡ï¼Œå†æ¥!", "å“¼ï¼Œç»§ç»­æŠ½!", "å¥½è¿åœ¨åé¢!"];
        const hintButtonText = "æ„Ÿè§‰å¤§å¥–å°±åœ¨å‰é¢...";

        let count = 0; let rotation = 0; let isGrandPrize = false;
        const spinner = document.getElementById('spinner');
        const btn = document.getElementById('spinBtn');
        const resultModal = document.getElementById('resultModal');
        const letterModal = document.getElementById('letterModal');
        const codeModal = document.getElementById('codeModal');
        const mIcon = document.getElementById('m-icon');
        const mBtn = document.getElementById('closeBtn'); 
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function handleButtonClick() {
            if (btn.classList.contains('envelope-btn')) {
                letterModal.style.display = 'flex';
            } else {
                startSpin();
            }
        }

        function playTick() {
            if(audioCtx.state==='suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
            osc.type = 'sine'; osc.frequency.setValueAtTime(400, audioCtx.currentTime); osc.frequency.linearRampToValueAtTime(600, audioCtx.currentTime + 0.08);
            gain.gain.setValueAtTime(0.5, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.08);
            osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime + 0.08);
        }
        function playWinSound() {
            if(audioCtx.state === 'suspended') audioCtx.resume();
            const now = audioCtx.currentTime;
            const notes = [1046.50, 1318.51, 1567.98, 2093.00, 2637.02, 3135.96]; 
            notes.forEach((freq, i) => {
                const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
                osc.type = 'sine'; osc.frequency.value = freq;
                const start = now + (i * 0.08); 
                gain.gain.setValueAtTime(0, start); gain.gain.linearRampToValueAtTime(0.3, start + 0.02); gain.gain.exponentialRampToValueAtTime(0.01, start + 0.8);
                osc.connect(gain); gain.connect(audioCtx.destination); osc.start(start); osc.stop(start + 0.8);
            });
        }
        function playLoseSound() {
            const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
            osc.type = 'sawtooth'; osc.frequency.setValueAtTime(150, audioCtx.currentTime); osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime+0.3);
            gain.gain.setValueAtTime(0.2, audioCtx.currentTime); gain.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime+0.3);
            osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime+0.3);
        }
        function easeOutCubic(t) { return 1 - Math.pow(1 - t, 3); }

        function startSpin() {
            count++; btn.disabled = true; btn.innerText = "å¥½è¿æµè½¬ä¸­...";
            let target; let isWin = false;
            if(count <= 4) { target = 210; isWin = false; } else { target = 90; isWin = true; }

            let circle = 360 * 6; let offset = -target;
            const startRotation = rotation; 
            const finalRotation = rotation + circle + offset - (rotation % 360);
            rotation = finalRotation;

            const duration = 4000; let startTime = null;
            let lastSoundIndex = Math.floor(startRotation / 60); 

            function animate(timestamp) {
                if (!startTime) startTime = timestamp;
                const elapsed = timestamp - startTime;
                const progress = Math.min(elapsed / duration, 1); 
                const ease = easeOutCubic(progress);
                const currentAngle = startRotation + (finalRotation - startRotation) * ease;
                spinner.style.transform = `rotate(${currentAngle}deg)`;
                
                const currentSoundIndex = Math.floor(currentAngle / 60);
                if (currentSoundIndex > lastSoundIndex) { playTick(); lastSoundIndex = currentSoundIndex; }
                if (progress < 1) { requestAnimationFrame(animate); } else { finishSpin(isWin); }
            }
            requestAnimationFrame(animate);
        }

        function finishSpin(isWin) {
            isGrandPrize = isWin; 
            if(isWin) {
                playWinSound(); 
                document.getElementById('m-title').innerText = "ğŸ‰ ä¸­å¤§å¥–å•¦ï¼";
                document.getElementById('m-title').style.color = "#FF2D55";
                mIcon.src = winIcon; mIcon.className = "anim-win"; 
                document.getElementById('m-text').innerHTML = "å¤©å‘ï¼ä½ æŠ½ä¸­äº†ã€ç¥ç§˜å¤§å¥–ã€‘ï¼<br><strong>å¿«é—®è€å…¬æ˜¯ä»€ä¹ˆï¼</strong><br>(ç¤¼ç‰©å±äºä½ å•¦)";
                mBtn.innerText = "å¼€å¿ƒæ”¶ä¸‹"; mBtn.style.background = "#FF2D55";
                btn.innerText = "å†æ¬¡å›å‘³ä¸­å¥–ç¬é—´ â¤ï¸"; btn.style.background = "#34C759";
            } else {
                playLoseSound();
                document.getElementById('m-title').innerText = "é—æ†¾ç¦»åœº...";
                document.getElementById('m-title').style.color = "#666";
                
                // ã€ä¿®æ”¹ç‚¹ã€‘å›ºå®šä½¿ç”¨ sad.gifï¼Œä¸å†éšæœº
                mIcon.src = "sad.gif"; 
                mIcon.className = "anim-lose"; 
                
                document.getElementById('m-text').innerHTML = "å“å‘€ï¼ä»€ä¹ˆéƒ½æ²¡æœ‰æŠ½åˆ°ï¼<br><strong>è€å©†å¤§äºº</strong>ï¼Œå†è¯•ä¸€æ¬¡ï¼Œæ‰‹æ°”åœ¨åé¢ï¼";
                
                if (count < 4) {
                    const randomText = loseButtonTexts[Math.floor(Math.random() * loseButtonTexts.length)];
                    mBtn.innerText = randomText; mBtn.style.background = "#007AFF"; 
                } else {
                    mBtn.innerText = hintButtonText; mBtn.style.background = "#5856D6"; 
                }
                btn.innerText = `å†æŠ½ä¸€æ¬¡ (ç¬¬ ${count+1} æ¬¡)`; btn.style.background = "#007AFF";
            }
            resultModal.style.display = 'flex'; btn.disabled = false;
        }

        function closeResultModal() {
            resultModal.style.display = 'none';
            // å¦‚æœä¸­äº†å¤§å¥–ï¼Œå…³é—­å¼¹çª—åï¼ŒæŒ‰é’®å˜æˆä¿¡å°
            if (isGrandPrize) {
                btn.innerText = "ğŸ’Œ äº²å¯ä¿¡ä»¶";
                btn.className = "envelope-btn"; 
                btn.style.background = "#FF2D55";
                btn.onclick = handleButtonClick; 
            }
        }

        function openGiftCode() {
            letterModal.style.display = 'none'; 
            codeModal.style.display = 'flex';   
            playWinSound(); 
        }
    </script>
</body>
</html>
